# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Reentrancy: State change after external call](#h-1-reentrancy-state-change-after-external-call)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Costly operations inside loop](#l-2-costly-operations-inside-loop)
  - [L-3: Large Numeric Literal](#l-3-large-numeric-literal)
  - [L-4: Literal Instead of Constant](#l-4-literal-instead-of-constant)
  - [L-5: Address State Variable Set Without Checks](#l-5-address-state-variable-set-without-checks)
  - [L-6: Unchecked Return](#l-6-unchecked-return)
  - [L-7: Unused Error](#l-7-unused-error)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 5 |
| Total nSLOC | 595 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/staking/RewardsDistributor.sol | 184 |
| src/staking/Staking.sol | 164 |
| src/token/K613.sol | 53 |
| src/token/xK613.sol | 65 |
| src/treasury/Treasury.sol | 129 |
| **Total** | **595** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 1 |
| Low | 7 |


# High Issues

## H-1: Reentrancy: State change after external call

Changing state after an external call can lead to re-entrancy attacks.Use the checks-effects-interactions pattern to avoid this issue.

<details><summary>1 Found Instances</summary>


- Found in src/staking/RewardsDistributor.sol [Line: 130](src/staking/RewardsDistributor.sol#L130)

	State is changed at: `userPendingRewards[msg.sender] = 0`
	```solidity
	        if (address(staking) != address(0) && IStaking(staking).exitQueueLength(msg.sender) > 0) {
	```

</details>



# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>26 Found Instances</summary>


- Found in src/staking/RewardsDistributor.sol [Line: 17](src/staking/RewardsDistributor.sol#L17)

	```solidity
	contract RewardsDistributor is AccessControl, Pausable, ReentrancyGuard {
	```

- Found in src/staking/RewardsDistributor.sol [Line: 92](src/staking/RewardsDistributor.sol#L92)

	```solidity
	    function setStaking(address staking_) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/staking/RewardsDistributor.sol [Line: 143](src/staking/RewardsDistributor.sol#L143)

	```solidity
	    function notifyReward(uint256 amount) external nonReentrant onlyRole(REWARDS_NOTIFIER_ROLE) whenNotPaused {
	```

- Found in src/staking/RewardsDistributor.sol [Line: 155](src/staking/RewardsDistributor.sol#L155)

	```solidity
	    function addPendingPenalty(uint256 amount) external nonReentrant onlyRole(REWARDS_NOTIFIER_ROLE) whenNotPaused {
	```

- Found in src/staking/RewardsDistributor.sol [Line: 173](src/staking/RewardsDistributor.sol#L173)

	```solidity
	    function pause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/staking/RewardsDistributor.sol [Line: 178](src/staking/RewardsDistributor.sol#L178)

	```solidity
	    function unpause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/staking/Staking.sol [Line: 66](src/staking/Staking.sol#L66)

	```solidity
	contract Staking is AccessControl, Pausable, ReentrancyGuard {
	```

- Found in src/staking/Staking.sol [Line: 142](src/staking/Staking.sol#L142)

	```solidity
	    function setRewardsDistributor(address distributor) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/staking/Staking.sol [Line: 313](src/staking/Staking.sol#L313)

	```solidity
	    function pause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/staking/Staking.sol [Line: 318](src/staking/Staking.sol#L318)

	```solidity
	    function unpause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/token/K613.sol [Line: 11](src/token/K613.sol#L11)

	```solidity
	contract K613 is ERC20, AccessControl, Pausable {
	```

- Found in src/token/K613.sol [Line: 43](src/token/K613.sol#L43)

	```solidity
	    function setMinter(address newMinter) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/token/K613.sol [Line: 74](src/token/K613.sol#L74)

	```solidity
	    function pause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/token/K613.sol [Line: 79](src/token/K613.sol#L79)

	```solidity
	    function unpause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/token/xK613.sol [Line: 11](src/token/xK613.sol#L11)

	```solidity
	contract xK613 is ERC20, AccessControl, Pausable {
	```

- Found in src/token/xK613.sol [Line: 51](src/token/xK613.sol#L51)

	```solidity
	    function setMinter(address newMinter) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/token/xK613.sol [Line: 64](src/token/xK613.sol#L64)

	```solidity
	    function setTransferWhitelist(address account, bool allowed) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/token/xK613.sol [Line: 90](src/token/xK613.sol#L90)

	```solidity
	    function pause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/token/xK613.sol [Line: 95](src/token/xK613.sol#L95)

	```solidity
	    function unpause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/treasury/Treasury.sol [Line: 15](src/treasury/Treasury.sol#L15)

	```solidity
	contract Treasury is AccessControl, Pausable, ReentrancyGuard {
	```

- Found in src/treasury/Treasury.sol [Line: 81](src/treasury/Treasury.sol#L81)

	```solidity
	    function depositRewards(uint256 amount) external nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) whenNotPaused {
	```

- Found in src/treasury/Treasury.sol [Line: 94](src/treasury/Treasury.sol#L94)

	```solidity
	    function setRouterWhitelist(address router, bool allowed) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/treasury/Treasury.sol [Line: 140](src/treasury/Treasury.sol#L140)

	```solidity
	    ) external nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) whenNotPaused returns (uint256 k613Out) {
	```

- Found in src/treasury/Treasury.sol [Line: 173](src/treasury/Treasury.sol#L173)

	```solidity
	    function withdraw(address token, address to, uint256 amount) external nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/treasury/Treasury.sol [Line: 185](src/treasury/Treasury.sol#L185)

	```solidity
	    function pause() external onlyRole(PAUSER_ROLE) {
	```

- Found in src/treasury/Treasury.sol [Line: 190](src/treasury/Treasury.sol#L190)

	```solidity
	    function unpause() external onlyRole(PAUSER_ROLE) {
	```

</details>



## L-2: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>1 Found Instances</summary>


- Found in src/treasury/Treasury.sol [Line: 114](src/treasury/Treasury.sol#L114)

	```solidity
	        for (uint256 i = 0; i < len; ++i) {
	```

</details>



## L-3: Large Numeric Literal

Large literal values multiples of 10000 can be replaced with scientific notation.Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>2 Found Instances</summary>


- Found in src/staking/Staking.sol [Line: 131](src/staking/Staking.sol#L131)

	```solidity
	        if (instantExitPenaltyBps_ > 10_000) revert InvalidBps();
	```

- Found in src/staking/Staking.sol [Line: 279](src/staking/Staking.sol#L279)

	```solidity
	        uint256 penalty = (amount * instantExitPenaltyBps) / 10_000;
	```

</details>



## L-4: Literal Instead of Constant

Define and use `constant` variables instead of using literals. If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>2 Found Instances</summary>


- Found in src/staking/Staking.sol [Line: 131](src/staking/Staking.sol#L131)

	```solidity
	        if (instantExitPenaltyBps_ > 10_000) revert InvalidBps();
	```

- Found in src/staking/Staking.sol [Line: 279](src/staking/Staking.sol#L279)

	```solidity
	        uint256 penalty = (amount * instantExitPenaltyBps) / 10_000;
	```

</details>



## L-5: Address State Variable Set Without Checks

Check for `address(0)` when assigning values to address state variables.

<details><summary>1 Found Instances</summary>


- Found in src/staking/Staking.sol [Line: 143](src/staking/Staking.sol#L143)

	```solidity
	        rewardsDistributor = RewardsDistributor(distributor);
	```

</details>



## L-6: Unchecked Return

Function returns a value but it is ignored. Consider checking the return value.

<details><summary>18 Found Instances</summary>


- Found in src/staking/RewardsDistributor.sol [Line: 82](src/staking/RewardsDistributor.sol#L82)

	```solidity
	        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
	```

- Found in src/staking/RewardsDistributor.sol [Line: 83](src/staking/RewardsDistributor.sol#L83)

	```solidity
	        _grantRole(PAUSER_ROLE, msg.sender);
	```

- Found in src/staking/RewardsDistributor.sol [Line: 94](src/staking/RewardsDistributor.sol#L94)

	```solidity
	            _revokeRole(REWARDS_NOTIFIER_ROLE, address(staking));
	```

- Found in src/staking/RewardsDistributor.sol [Line: 98](src/staking/RewardsDistributor.sol#L98)

	```solidity
	            _grantRole(REWARDS_NOTIFIER_ROLE, staking_);
	```

- Found in src/staking/Staking.sol [Line: 132](src/staking/Staking.sol#L132)

	```solidity
	        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
	```

- Found in src/staking/Staking.sol [Line: 133](src/staking/Staking.sol#L133)

	```solidity
	        _grantRole(PAUSER_ROLE, msg.sender);
	```

- Found in src/token/K613.sol [Line: 34](src/token/K613.sol#L34)

	```solidity
	        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
	```

- Found in src/token/K613.sol [Line: 35](src/token/K613.sol#L35)

	```solidity
	        _grantRole(PAUSER_ROLE, msg.sender);
	```

- Found in src/token/K613.sol [Line: 37](src/token/K613.sol#L37)

	```solidity
	        _grantRole(MINTER_ROLE, initialMinter);
	```

- Found in src/token/K613.sol [Line: 47](src/token/K613.sol#L47)

	```solidity
	        _revokeRole(MINTER_ROLE, minter);
	```

- Found in src/token/K613.sol [Line: 50](src/token/K613.sol#L50)

	```solidity
	        _grantRole(MINTER_ROLE, newMinter);
	```

- Found in src/token/xK613.sol [Line: 42](src/token/xK613.sol#L42)

	```solidity
	        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
	```

- Found in src/token/xK613.sol [Line: 43](src/token/xK613.sol#L43)

	```solidity
	        _grantRole(PAUSER_ROLE, msg.sender);
	```

- Found in src/token/xK613.sol [Line: 45](src/token/xK613.sol#L45)

	```solidity
	        _grantRole(MINTER_ROLE, initialMinter);
	```

- Found in src/token/xK613.sol [Line: 55](src/token/xK613.sol#L55)

	```solidity
	        _revokeRole(MINTER_ROLE, minter);
	```

- Found in src/token/xK613.sol [Line: 58](src/token/xK613.sol#L58)

	```solidity
	        _grantRole(MINTER_ROLE, newMinter);
	```

- Found in src/treasury/Treasury.sol [Line: 71](src/treasury/Treasury.sol#L71)

	```solidity
	        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
	```

- Found in src/treasury/Treasury.sol [Line: 72](src/treasury/Treasury.sol#L72)

	```solidity
	        _grantRole(PAUSER_ROLE, msg.sender);
	```

</details>



## L-7: Unused Error

Consider using or removing the unused error.

<details><summary>2 Found Instances</summary>


- Found in src/treasury/Treasury.sol [Line: 23](src/treasury/Treasury.sol#L23)

	```solidity
	    error NoController();
	```

- Found in src/treasury/Treasury.sol [Line: 25](src/treasury/Treasury.sol#L25)

	```solidity
	    error NoAssets();
	```

</details>



